import{s as C,v as c,a as _,b as I,c as w,d as x,F as W,D as X,N as V,H as O,f as z,P as U,T as K,g as H,h as v}from"./exercises-BTvngjs1.js";import"https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js";import{FilesetResolver as N,PoseLandmarker as Q}from"https://esm.sh/@mediapipe/tasks-vision@0.10.14";const b=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function R(E){return{...E,_poseMetrics(e){const s=e[11],t=e[12],l=e[13],a=e[14],h=e[23],o=e[24],g=e[15],u=e[16],r=e[27],d=e[28],m=e[25],S=e[26],n=c(s,.45)&&c(l,.45)&&c(h,.45)&&c(g,.45)&&c(r,.45),i=c(t,.45)&&c(a,.45)&&c(o,.45)&&c(u,.45)&&c(d,.45),p=n?v(s,h,r):null,y=i?v(t,o,d):null,f=n?Math.abs(s.y-h.y):null,A=i?Math.abs(t.y-o.y):null,k=n?v(l,s,h):null,M=i?v(a,t,o):null,L=n?s.x-g.x:null,T=i?t.x-u.x:null,Y=n&&c(m,.45),D=i&&c(S,.45),B=Y?v(m,h,s):null,F=D?v(S,o,t):null,P=Y?v(h,m,r):null,q=D?v(o,S,d):null;return{aL:p,aR:y,shHipYL:f,shHipYR:A,armTorsoL:k,armTorsoR:M,shWrXL:L,shWrXR:T,khsAngleL:B,khsAngleR:F,hkaAngleL:P,hkaAngleR:q}},_effectiveAngle(e){const{aL:s,aR:t}=this._poseMetrics(e);return s==null?t:t==null?s:(s+t)/2},canStart(e){const{aL:s,aR:t,shHipYL:l,shHipYR:a,armTorsoL:h,armTorsoR:o,shWrXL:g,shWrXR:u,khsAngleL:r,khsAngleR:d}=this._poseMetrics(e),m=s==null?t:t==null?s:(s+t)/2,S=l==null?a:a==null?l:(l+a)/2,n=h==null?o:o==null?h:(h+o)/2,i=g==null?u:u==null?g:(g+u)/2,p=r==null?d:d==null?r:(r+d)/2;if(console.log(`[${this.name}] canStart check:`,{ang:m==null?void 0:m.toFixed(1),yDiff:S==null?void 0:S.toFixed(3),armTorso:n==null?void 0:n.toFixed(1),shWrX:i==null?void 0:i.toFixed(3),khsAngle:p==null?void 0:p.toFixed(1),thresholds:{straightStartDeg:this.straightStartDeg,shHipYStartMax:this.shHipYStartMax,armTorsoMaxDeg:this.armTorsoMaxDeg,shWrXStartMin:this.shWrXStartMin}}),m==null||S==null||n==null)return console.log(`[${this.name}] âŒ canStart -> false (missing: ang=${m}, yDiff=${S}, armTorso=${n})`),!1;if(n>this.armTorsoMaxDeg)return console.log(`[${this.name}] âŒ canStart -> false (armTorso ${n.toFixed(1)}Â° > ${this.armTorsoMaxDeg}Â°)`),!1;if(this.requireShouldersAheadOfWrists&&(i==null||i<this.shWrXStartMin))return console.log(`[${this.name}] âŒ canStart -> false (shWrX ${i==null?void 0:i.toFixed(3)} < ${this.shWrXStartMin})`),!1;if(this.name==="Adv. tuck planche"&&(p==null||p<82))return console.log(`[${this.name}] âŒ canStart -> false (khsAngle ${p==null?void 0:p.toFixed(1)}Â° < 82Â°)`),!1;const y=this.straightStartDeg==null?!0:m>=this.straightStartDeg-this.hysteresisDeg,f=S<=this.shHipYStartMax;return y||console.log(`[${this.name}] âŒ canStart -> false (angle ${m.toFixed(1)}Â° < ${this.straightStartDeg-this.hysteresisDeg}Â°)`),f||console.log(`[${this.name}] âŒ canStart -> false (yDiff ${S.toFixed(3)} > ${this.shHipYStartMax})`),y&&f&&console.log(`[${this.name}] âœ… canStart -> TRUE!`),y&&f},canComplete(e){const{aL:s,aR:t,shHipYL:l,shHipYR:a,shWrXL:h,shWrXR:o,hkaAngleL:g,hkaAngleR:u}=this._poseMetrics(e),r=s==null?t:t==null?s:(s+t)/2,d=l==null?a:a==null?l:(l+a)/2,m=h==null?o:o==null?h:(h+o)/2,S=g==null?u:u==null?g:(g+u)/2;return r==null||d==null?!0:(this.name==="Full planche"||this.name==="Straddle planche"||this.name==="Planche lean")&&S!=null&&S<this.hkaAngleMinStop?(console.log(`VideoAnalyzer canComplete -> true (jambes pliÃ©es: hkaAngle ${S}Â° < ${this.hkaAngleMinStop}Â°)`),!0):!!(this.requireShouldersAheadOfWrists&&(m==null||m<this.shWrXStopMin)||this.straightStopDeg!=null&&r<=this.straightStopDeg+this.hysteresisDeg||d>=this.shHipYStopMax)},getAscentSignal(e){const s=e[11],t=e[12];return!c(s,.35)||!c(t,.35)?null:(s.y+t.y)/2}}}function $(E,e={}){return{name:E,mode:"hold",tracking:"timer",initState:"off",activeState:"on",idleEndState:"off",requiredVisibility:.45,armTorsoMaxDeg:135,shHipYMax:.08,hipAnkleYMax:.12,hysteresisDeg:2,sidePolicy:"either",_poseMetrics(s){const t=s[11],l=s[12],a=s[13],h=s[14],o=s[23],g=s[24],u=s[25],r=s[26],d=s[27],m=s[28],S=c(t,this.requiredVisibility)&&c(a,this.requiredVisibility)&&c(o,this.requiredVisibility)&&c(d,this.requiredVisibility),n=c(l,this.requiredVisibility)&&c(h,this.requiredVisibility)&&c(g,this.requiredVisibility)&&c(m,this.requiredVisibility),i=S?v(a,t,o):null,p=n?v(h,l,g):null,y=S?Math.abs(t.y-o.y):null,f=n?Math.abs(l.y-g.y):null,A=S?Math.abs(o.y-d.y):null,k=n?Math.abs(g.y-m.y):null,M=S&&c(u,this.requiredVisibility)?v(o,u,d):null,L=n&&c(r,this.requiredVisibility)?v(g,r,m):null;return{armTorsoL:i,armTorsoR:p,shHipYL:y,shHipYR:f,hipAnkYL:A,hipAnkYR:k,hkaAngleL:M,hkaAngleR:L}},_avg(s,t){return s==null?t:t==null?s:(s+t)/2},canStart(s){const{armTorsoL:t,armTorsoR:l,shHipYL:a,shHipYR:h,hipAnkYL:o,hipAnkYR:g}=this._poseMetrics(s),u=this._avg(t,l),r=this._avg(a,h),d=this._avg(o,g);return!(u==null||r==null||d==null||u>this.armTorsoMaxDeg+this.hysteresisDeg||r>this.shHipYMax||d>this.hipAnkleYMax)},canComplete(s){const{armTorsoL:t,armTorsoR:l,shHipYL:a,shHipYR:h,hipAnkYL:o,hipAnkYR:g}=this._poseMetrics(s),u=this._avg(t,l),r=this._avg(a,h),d=this._avg(o,g);return u==null||r==null||d==null||u>this.armTorsoMaxDeg+this.hysteresisDeg||r>this.shHipYMax||d>this.hipAnkleYMax},getAscentSignal(s){const t=s[11],l=s[12];return!c(t,.35)||!c(l,.35)?null:(t.y+l.y)/2},...e}}function j(E,e={}){return{name:E,mode:"hold",tracking:"timer",initState:"off",activeState:"on",idleEndState:"off",requiredVisibility:.45,straightStartDeg:155,straightStopDeg:135,hysteresisDeg:3,shHipYMax:.08,hipAnkleYMax:.1,armTorsoMaxDeg:140,sidePolicy:"either",_poseMetrics(s){const t=s[11],l=s[12],a=s[13],h=s[14],o=s[23],g=s[24],u=s[27],r=s[28],d=c(t,this.requiredVisibility)&&c(a,this.requiredVisibility)&&c(o,this.requiredVisibility)&&c(u,this.requiredVisibility),m=c(l,this.requiredVisibility)&&c(h,this.requiredVisibility)&&c(g,this.requiredVisibility)&&c(r,this.requiredVisibility),S=d?v(t,o,u):null,n=m?v(l,g,u):null,i=d?v(a,t,o):null,p=m?v(h,l,g):null,y=d?Math.abs(t.y-o.y):null,f=m?Math.abs(l.y-g.y):null,A=d?Math.abs(o.y-u.y):null,k=m?Math.abs(g.y-r.y):null;return{straightL:S,straightR:n,armTorsoL:i,armTorsoR:p,shHipYL:y,shHipYR:f,hipAnkYL:A,hipAnkYR:k}},_avg(s,t){return s==null?t:t==null?s:(s+t)/2},canStart(s){const t=this._poseMetrics(s),l=this._avg(t.straightL,t.straightR),a=this._avg(t.armTorsoL,t.armTorsoR),h=this._avg(t.shHipYL,t.shHipYR),o=this._avg(t.hipAnkYL,t.hipAnkYR);return l==null||a==null||h==null||o==null||a>this.armTorsoMaxDeg?!1:l>=this.straightStartDeg-this.hysteresisDeg&&h<=this.shHipYMax&&o<=this.hipAnkleYMax},canComplete(s){const t=this._poseMetrics(s),l=this._avg(t.straightL,t.straightR),a=this._avg(t.shHipYL,t.shHipYR),h=this._avg(t.hipAnkYL,t.hipAnkYR);return l==null||a==null||h==null||l<=this.straightStopDeg+this.hysteresisDeg||a>this.shHipYMax||h>this.hipAnkleYMax},getAscentSignal(s){const t=s[11],l=s[12];return!c(t,.35)||!c(l,.35)?null:(t.y+l.y)/2},...e}}function G(){return{Tractions:K,Pompes:U,Handstand:z,"Handstand Push Up":O,"90 Degree HSPU":V,Dips:X,"Front Lever Raises":W,"Straddle planche":R({...H("Straddle planche"),name:"Straddle planche"}),"Full planche":R({...H("Full planche"),name:"Full planche",straightStartDeg:129,straightStopDeg:125,shHipYStartMax:.28,shHipYStopMax:.3,shWrXStartMin:.2,shWrXStopMin:.19,armTorsoMaxDeg:120}),"Tuck planche":R({...H("Tuck planche"),name:"Tuck planche",straightStartDeg:null,straightStopDeg:null,shHipYStartMax:.11,shHipYStopMax:.09,shWrXStartMin:.06,shWrXStopMin:.05}),"Adv. tuck planche":R({...H("Adv. tuck planche"),name:"Adv. tuck planche",straightStartDeg:null,straightStopDeg:null,shHipYStartMax:.11,shHipYStopMax:.09,shWrXStartMin:.06,shWrXStopMin:.05}),"Planche lean":R({...H("Planche lean"),name:"Planche lean",shHipYStartMax:.09,shHipYStopMax:.1}),"Front Lever":$("Front Lever",{armTorsoMaxDeg:100}),"Tuck Front Lever":$("Tuck Front Lever",{armTorsoMaxDeg:145}),"Straddle Front Lever":$("Straddle Front Lever",{armTorsoMaxDeg:140}),"Human Flag":j("Human Flag")}}class J{constructor(){this.videoElement=document.getElementById("videoElement"),this.canvasElement=document.getElementById("canvasElement"),this.ctx=this.canvasElement.getContext("2d"),this.poseLandmarker=null,this.exercise=null,this.EXERCISES=G(),this.isAnalyzing=!1,this.repState=null,this.repStarted=!1,this.stateFrameCount=0,this.consecutiveFramesRequired=2,this.currentSetReps=0,this.holdStartTime=null,this.currentSetDisplay=null,this.qualitySamples=[],this.leanScoreSamples=[],this.trunkScoreSamples=[],this.alignmentScoreSamples=[],this.kneeHipShoulderScoreSamples=[],this.straightLegsScoreSamples=[],this.verticalityScoreSamples=[],this.elbowDepthScoreSamples=[],this.alignmentAngleSamples=[],this.verticalityAngleSamples=[],this.setupUI(),this.initializePoseTracking()}setupUI(){const e=document.getElementById("videoFile"),s=document.getElementById("analyzeBtn"),t=document.getElementById("restartBtn"),l=document.getElementById("reanalyzeBtn");e.addEventListener("change",a=>{if(a.target.files.length>0){s.disabled=!1;const h=a.target.files[0],o=URL.createObjectURL(h);this.videoElement.src=o,this.videoElement.load()}}),s.addEventListener("click",()=>this.startAnalysis()),l.addEventListener("click",()=>this.reanalyze()),t.addEventListener("click",()=>this.restart())}async initializePoseTracking(){try{const e=await N.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14/wasm");this.poseLandmarker=await Q.createFromOptions(e,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/1/pose_landmarker_lite.task",delegate:"GPU"},runningMode:"VIDEO",numPoses:1}),console.log("âœ… PoseLandmarker initialized")}catch(e){console.error("âŒ Failed to initialize PoseLandmarker:",e),this.showStatus("Erreur d'initialisation de la dÃ©tection de pose","error")}}async startAnalysis(){const e=document.getElementById("exerciseSelect").value;if(this.exercise=this.EXERCISES[e],!this.exercise){this.showStatus("Exercice non reconnu","error");return}if(!this.poseLandmarker){this.showStatus("DÃ©tection de pose non initialisÃ©e","error");return}this.repState=this.exercise.initState,this.repStarted=!1,this.stateFrameCount=0,this.currentSetReps=0,this.holdStartTime=null,this.currentSetDisplay=null,this.holdCompleted=!1,this.qualitySamples=[],this.leanScoreSamples=[],this.trunkScoreSamples=[],this.alignmentScoreSamples=[],this.kneeHipShoulderScoreSamples=[],this.straightLegsScoreSamples=[],this.verticalityScoreSamples=[],this.elbowDepthScoreSamples=[],this.alignmentAngleSamples=[],this.verticalityAngleSamples=[],this.shHipYSamples=[],this.shWrXSamples=[],this.hkaAngleSamples=[],this.khsAngleSamples=[],this.elbowAngleSamples=[],document.getElementById("uploadSection").style.display="none",document.getElementById("videoPreview").classList.add("active"),document.getElementById("progressBar").classList.add("active"),document.getElementById("results").classList.remove("active"),this.showStatus("Analyse en cours...","processing"),this.isAnalyzing=!0,this.videoElement.addEventListener("loadedmetadata",()=>{this.canvasElement.width=this.videoElement.videoWidth,this.canvasElement.height=this.videoElement.videoHeight},{once:!0}),await this.videoElement.play(),this.processVideo()}async processVideo(){const e=async()=>{if(!this.isAnalyzing||this.videoElement.paused||this.videoElement.ended){this.videoElement.ended&&this.finalizeAnalysis();return}const s=this.videoElement.currentTime/this.videoElement.duration*100;document.getElementById("progressFill").style.width=`${s}%`,document.getElementById("progressFill").textContent=`${Math.round(s)}%`;const t=this.poseLandmarker.detectForVideo(this.videoElement,performance.now());if(this.ctx.clearRect(0,0,this.canvasElement.width,this.canvasElement.height),t.landmarks&&t.landmarks.length>0){const l=t.landmarks[0];this.drawLandmarks(l),this.trackMovement(l),this.sampleQuality(l)}requestAnimationFrame(e)};e()}trackMovement(e){if(!(!e||!this.exercise)){if(this.exercise.tracking==="timer"||this.exercise.mode==="hold"){this.trackTimer(e);return}this.repState===this.exercise.initState?!this.repStarted&&this.exercise.canStart(e)?(this.stateFrameCount++,this.stateFrameCount>=this.consecutiveFramesRequired&&(this.repState=this.exercise.activeState,this.repStarted=!0,this.stateFrameCount=0)):this.stateFrameCount=0:this.repState===this.exercise.activeState&&(this.repStarted&&this.exercise.canComplete(e)?(this.stateFrameCount++,this.stateFrameCount>=this.consecutiveFramesRequired&&(this.repState=this.exercise.initState,this.currentSetReps++,this.stateFrameCount=0,this.repStarted=!1)):this.stateFrameCount=0)}}trackTimer(e){if(!this.holdCompleted){if(this.repState===this.exercise.initState)!this.repStarted&&this.exercise.canStart(e)?(this.stateFrameCount++,this.stateFrameCount>=this.consecutiveFramesRequired&&(this.repState=this.exercise.activeState,this.repStarted=!0,this.stateFrameCount=0,this.holdStartTime=this.videoElement.currentTime,this.currentSetReps=0,console.log(`ðŸŸ¢ Hold START at ${this.holdStartTime.toFixed(2)}s`))):this.stateFrameCount=0;else if(this.repState===this.exercise.activeState){if(this.holdStartTime!=null){const s=Math.max(0,this.videoElement.currentTime-this.holdStartTime),t=Math.floor(s);t!==this.currentSetReps&&(this.currentSetReps=t),this.currentSetDisplay=Math.round(s*10)/10}if(this.repStarted&&this.exercise.canComplete(e)){if(this.stateFrameCount++,this.stateFrameCount>=this.consecutiveFramesRequired){const s=this.videoElement.currentTime;if(this.repState=this.exercise.initState,this.stateFrameCount=0,this.repStarted=!1,this.holdStartTime!=null){const t=Math.max(0,s-this.holdStartTime);this.currentSetReps=Math.max(this.currentSetReps,Math.floor(t)),console.log(`ðŸ”´ Hold STOP at ${s.toFixed(2)}s (duration: ${t.toFixed(2)}s)`),this.holdCompleted=!0}}}else this.stateFrameCount=0}}}sampleQuality(e){var l,a,h,o,g,u,r,d,m,S;if(!this.exercise||this.repState!==this.exercise.activeState)return;let s=null;const t=this.exercise.name||"";if(t.toLowerCase().includes("planche")){const n=C(e,this.exercise);s=n==null?void 0:n.avgScore,(n==null?void 0:n.leanScore)!=null&&this.leanScoreSamples.push(n.leanScore),(n==null?void 0:n.trunkScore)!=null&&this.trunkScoreSamples.push(n.trunkScore),(n==null?void 0:n.alignmentScore)!=null&&this.alignmentScoreSamples.push(n.alignmentScore),(n==null?void 0:n.kneeHipShoulderScore)!=null&&this.kneeHipShoulderScoreSamples.push(n.kneeHipShoulderScore),(n==null?void 0:n.straightLegsScore)!=null&&this.straightLegsScoreSamples.push(n.straightLegsScore);const i=(a=(l=this.exercise)._poseMetrics)==null?void 0:a.call(l,e);if(i){const p=i.aL==null?i.aR:i.aR==null?i.aL:(i.aL+i.aR)/2,y=i.shHipYL==null?i.shHipYR:i.shHipYR==null?i.shHipYL:(i.shHipYL+i.shHipYR)/2,f=i.shWrXL==null?i.shWrXR:i.shWrXR==null?i.shWrXL:(i.shWrXL+i.shWrXR)/2,A=i.hkaAngleL==null?i.hkaAngleR:i.hkaAngleR==null?i.hkaAngleL:(i.hkaAngleL+i.hkaAngleR)/2,k=i.khsAngleL==null?i.khsAngleR:i.khsAngleR==null?i.khsAngleL:(i.khsAngleL+i.khsAngleR)/2;p!=null&&this.alignmentAngleSamples.push(p),y!=null&&this.shHipYSamples.push(y),f!=null&&this.shWrXSamples.push(f),A!=null&&this.hkaAngleSamples.push(A),k!=null&&this.khsAngleSamples.push(k)}}else if(this.exercise.mode==="hold"&&typeof this.exercise._effectiveAngle=="function"){const n=this.exercise._effectiveAngle(e);if(s=w(n,175,b),s!=null&&this.alignmentScoreSamples.push(s),n!=null&&this.alignmentAngleSamples.push(n),t==="Handstand"){const i=e[11],p=e[12],y=e[27],f=e[28],A=c(i,.4)&&c(y,.4),k=c(p,.4)&&c(f,.4),M=A&&k?{x:(i.x+p.x)/2,y:(i.y+p.y)/2}:A?i:k?p:null,L=A&&k?{x:(y.x+f.x)/2,y:(y.y+f.y)/2}:A?y:k?f:null;if(M&&L){const T=_(M,L,b);if(T!=null){this.verticalityScoreSamples.push(T);const Y=L.x-M.x,D=L.y-M.y,F=Math.atan2(Math.abs(Y),Math.abs(D))*180/Math.PI;this.verticalityAngleSamples.push(F)}}}}else if(t==="Handstand Push Up"){const n=(o=(h=this.exercise)._elbowAngles)==null?void 0:o.call(h,e),i=I(n),p=(u=(g=this.exercise)._bodyAlignment)==null?void 0:u.call(g,e),y=w(p,180,b);i!=null&&y!=null?(s=(i+y)/2,this.elbowDepthScoreSamples.push(i),this.alignmentScoreSamples.push(y),p!=null&&this.alignmentAngleSamples.push(p),n!=null&&this.elbowAngleSamples.push(n)):i!=null&&(s=i,this.elbowDepthScoreSamples.push(i),n!=null&&this.elbowAngleSamples.push(n))}else if(t==="90 Degree HSPU"){const n=(d=(r=this.exercise)._poseMetrics)==null?void 0:d.call(r,e),i=n?n.elbowL??n.elbowR:null,p=I(i),y=(S=(m=this.exercise)._bodyAlignment)==null?void 0:S.call(m,e),f=w(y,180,b);p!=null&&f!=null?(s=(p+f)/2,this.elbowDepthScoreSamples.push(p),this.alignmentScoreSamples.push(f),y!=null&&this.alignmentAngleSamples.push(y),i!=null&&this.elbowAngleSamples.push(i)):p!=null&&(s=p,this.elbowDepthScoreSamples.push(p),i!=null&&this.elbowAngleSamples.push(i))}s!=null&&this.qualitySamples.push(s)}drawLandmarks(e){const s=[[11,12],[11,23],[12,24],[23,24],[11,13],[13,15],[12,14],[14,16],[23,25],[25,27],[24,26],[26,28]];this.ctx.strokeStyle="#00ff00",this.ctx.lineWidth=3,s.forEach(([l,a])=>{const h=e[l],o=e[a];h&&o&&c(h,.3)&&c(o,.3)&&(this.ctx.beginPath(),this.ctx.moveTo(h.x*this.canvasElement.width,h.y*this.canvasElement.height),this.ctx.lineTo(o.x*this.canvasElement.width,o.y*this.canvasElement.height),this.ctx.stroke())}),this.ctx.fillStyle="#ff0000",[0,11,12,13,14,15,16,23,24,25,26,27,28].forEach(l=>{const a=e[l];a&&c(a,.3)&&(this.ctx.beginPath(),this.ctx.arc(a.x*this.canvasElement.width,a.y*this.canvasElement.height,5,0,2*Math.PI),this.ctx.fill())})}finalizeAnalysis(){this.isAnalyzing=!1,this.videoElement.pause();const e=this.qualitySamples.length>3?this.qualitySamples.slice(0,-3):this.qualitySamples,s=x(e),t=s!=null?Math.round(s*10)/10:null,l={leanScore:this.leanScoreSamples.length>0?Math.round(x(this.leanScoreSamples)*10)/10:null,trunkScore:this.trunkScoreSamples.length>0?Math.round(x(this.trunkScoreSamples)*10)/10:null,alignmentScore:this.alignmentScoreSamples.length>0?Math.round(x(this.alignmentScoreSamples)*10)/10:null,kneeHipShoulderScore:this.kneeHipShoulderScoreSamples.length>0?Math.round(x(this.kneeHipShoulderScoreSamples)*10)/10:null,straightLegsScore:this.straightLegsScoreSamples.length>0?Math.round(x(this.straightLegsScoreSamples)*10)/10:null,verticalityScore:this.verticalityScoreSamples.length>0?Math.round(x(this.verticalityScoreSamples)*10)/10:null,elbowDepthScore:this.elbowDepthScoreSamples.length>0?Math.round(x(this.elbowDepthScoreSamples)*10)/10:null,alignmentAngle:this.alignmentAngleSamples.length>0?Math.round(x(this.alignmentAngleSamples)*10)/10:null,verticalityAngle:this.verticalityAngleSamples.length>0?Math.round(x(this.verticalityAngleSamples)*10)/10:null,shHipY:this.shHipYSamples.length>0?Math.round(x(this.shHipYSamples)*1e3)/1e3:null,shWrX:this.shWrXSamples.length>0?Math.round(x(this.shWrXSamples)*1e3)/1e3:null,hkaAngle:this.hkaAngleSamples.length>0?Math.round(x(this.hkaAngleSamples)*10)/10:null,khsAngle:this.khsAngleSamples.length>0?Math.round(x(this.khsAngleSamples)*10)/10:null,elbowAngle:this.elbowAngleSamples.length>0?Math.round(x(this.elbowAngleSamples)*10)/10:null};this.displayResults(t,l)}displayResults(e,s){document.getElementById("progressBar").classList.remove("active"),document.getElementById("status").classList.remove("active"),document.getElementById("results").classList.add("active"),document.getElementById("resultExerciseName").textContent=this.exercise.name;const t=this.exercise.tracking==="timer"||this.exercise.mode==="hold";if(document.getElementById("resultLabel").textContent=t?"DurÃ©e du hold":"RÃ©pÃ©titions",document.getElementById("resultValue").textContent=t?`${this.currentSetDisplay||this.currentSetReps}s`:this.currentSetReps,e!=null){const l=document.getElementById("qualityScoreSection");l.style.display="block";const a=document.getElementById("qualityScoreValue");a.textContent=`${e}/10`,a.classList.remove("excellent","good","poor"),e>=9?a.classList.add("excellent"):e>=7?a.classList.add("good"):a.classList.add("poor"),this.displayQualityDetails(s)}else document.getElementById("qualityScoreSection").style.display="none"}displayQualityDetails(e){const s=document.getElementById("qualityDetails");s.innerHTML="";const t=this.exercise.name,l=t==="Handstand",a=t==="Handstand Push Up",h=t==="90 Degree HSPU",o=t==="Adv. tuck planche",g=t==="Straddle planche"||t==="Full planche"||t==="Planche lean"||t==="Front Lever",u=[];if(e.alignmentScore!=null&&!a&&!h){const r=e.alignmentAngle!=null?` (Moy: ${e.alignmentAngle.toFixed(1)}Â°)`:"";u.push({icon:"ðŸ“",name:l?"Alignement corps":"Alignement",score:e.alignmentScore,description:`${l?"Ã‰paules-hanches-chevilles droites":"Alignement Ã©paules-hanches-chevilles"}${r}`})}if(e.verticalityScore!=null&&l){const r=e.verticalityAngle!=null?` (Moy: ${e.verticalityAngle.toFixed(1)}Â°)`:"";u.push({icon:"ðŸ“",name:"VerticalitÃ©",score:e.verticalityScore,description:`Alignement par rapport Ã  la verticale${r}`})}if(e.leanScore!=null&&!l){const r=e.shWrX!=null?` (shWrX: ${e.shWrX.toFixed(3)})`:"";u.push({icon:"ðŸ’Ž",name:"Lean (avancÃ©e)",score:e.leanScore,description:`Position des Ã©paules par rapport aux poignets${r}`})}if(e.trunkScore!=null){const r=e.shHipY!=null?` (shHipY: ${e.shHipY.toFixed(3)})`:"";u.push({icon:"ðŸŽ¯",name:"Tronc",score:e.trunkScore,description:`Alignement du tronc${r}`})}if(e.kneeHipShoulderScore!=null&&o){const r=e.khsAngle!=null?` (Moy: ${e.khsAngle.toFixed(1)}Â°)`:"";u.push({icon:"ðŸ¦µ",name:"Genou-Hanche-Ã‰paule",score:e.kneeHipShoulderScore,description:`Alignement spÃ©cifique Advanced Tuck${r}`})}if(e.straightLegsScore!=null&&g){const r=e.hkaAngle!=null?` (Moy: ${e.hkaAngle.toFixed(1)}Â°)`:"";u.push({icon:"ðŸ¦µ",name:"Jambes tendues",score:e.straightLegsScore,description:`Extension des jambes${r}`})}if(e.elbowDepthScore!=null&&(a||h)){const r=e.elbowAngle!=null?` (Moy: ${e.elbowAngle.toFixed(1)}Â°)`:"";u.push({icon:"ðŸ’ª",name:"Profondeur coude",score:e.elbowDepthScore,description:`Angle du coude Ã  la descente${r}`})}if(e.alignmentScore!=null&&(a||h)){const r=e.alignmentAngle!=null?` (Moy: ${e.alignmentAngle.toFixed(1)}Â°)`:"";u.push({icon:"ðŸ“",name:"Alignement du corps",score:e.alignmentScore,description:`Ã‰paules-hanches-chevilles droites${r}`})}u.forEach(r=>{const d=document.createElement("div");d.className="quality-detail-item",d.innerHTML=`
        <div class="quality-detail-icon">${r.icon}</div>
        <div class="quality-detail-name">${r.name}</div>
        <div class="quality-detail-score">${r.score}/10</div>
        <div class="quality-detail-description">${r.description}</div>
      `,s.appendChild(d)})}showStatus(e,s){const t=document.getElementById("status");t.textContent=e,t.className=`status active ${s}`}reanalyze(){document.getElementById("results").classList.remove("active"),document.getElementById("progressBar").classList.remove("active"),document.getElementById("status").classList.remove("active"),this.isAnalyzing=!1,this.currentSetReps=0,this.currentSetDisplay=0,this.repState=null,this.repStarted=!1,this.stateFrameCount=0,this.holdStartTime=null,this.qualitySamples=[],this.leanScoreSamples=[],this.trunkScoreSamples=[],this.alignmentScoreSamples=[],this.kneeHipShoulderScoreSamples=[],this.straightLegsScoreSamples=[],this.verticalityScoreSamples=[],this.elbowDepthScoreSamples=[],this.alignmentAngleSamples=[],this.verticalityAngleSamples=[],this.videoElement.currentTime=0,this.videoElement.pause(),this.ctx.clearRect(0,0,this.canvasElement.width,this.canvasElement.height),this.startAnalysis()}restart(){document.getElementById("uploadSection").style.display="block",document.getElementById("videoPreview").classList.remove("active"),document.getElementById("results").classList.remove("active"),document.getElementById("progressBar").classList.remove("active"),document.getElementById("status").classList.remove("active"),document.getElementById("videoFile").value="",document.getElementById("analyzeBtn").disabled=!0,this.videoElement.src="",this.videoElement.load(),this.isAnalyzing=!1}}document.addEventListener("DOMContentLoaded",()=>{new J});
