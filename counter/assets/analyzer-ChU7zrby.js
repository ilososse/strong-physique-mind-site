import{d as q,s as C,v as c,a as _,b as $,c as x,F as W,D as V,N as X,H as O,f as U,P as z,T as K,g as H,h as v}from"./exercises-DeIGFFOu.js";import"https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js";import{FilesetResolver as N,PoseLandmarker as Q}from"https://esm.sh/@mediapipe/tasks-vision@0.10.14";const b=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function R(E){return{...E,_poseMetrics(e){const t=e[11],s=e[12],n=e[13],a=e[14],h=e[23],o=e[24],d=e[15],u=e[16],r=e[27],p=e[28],m=e[25],S=e[26],l=c(t,.45)&&c(n,.45)&&c(h,.45)&&c(d,.45)&&c(r,.45),i=c(s,.45)&&c(a,.45)&&c(o,.45)&&c(u,.45)&&c(p,.45),g=l?v(t,h,r):null,y=i?v(s,o,p):null,f=l?Math.abs(t.y-h.y):null,A=i?Math.abs(s.y-o.y):null,M=l?v(n,t,h):null,k=i?v(a,s,o):null,L=l?t.x-d.x:null,T=i?s.x-u.x:null,D=l&&c(m,.45),Y=i&&c(S,.45),B=D?v(m,h,t):null,F=Y?v(S,o,s):null,P=D?v(h,m,r):null,I=Y?v(o,S,p):null;return{aL:g,aR:y,shHipYL:f,shHipYR:A,armTorsoL:M,armTorsoR:k,shWrXL:L,shWrXR:T,khsAngleL:B,khsAngleR:F,hkaAngleL:P,hkaAngleR:I}},_effectiveAngle(e){const{aL:t,aR:s}=this._poseMetrics(e);return t==null?s:s==null?t:(t+s)/2},canStart(e){const{aL:t,aR:s,shHipYL:n,shHipYR:a,armTorsoL:h,armTorsoR:o,shWrXL:d,shWrXR:u,khsAngleL:r,khsAngleR:p}=this._poseMetrics(e),m=t==null?s:s==null?t:(t+s)/2,S=n==null?a:a==null?n:(n+a)/2,l=h==null?o:o==null?h:(h+o)/2,i=d==null?u:u==null?d:(d+u)/2,g=r==null?p:p==null?r:(r+p)/2;if(console.log(`[${this.name}] canStart check:`,{ang:m==null?void 0:m.toFixed(1),yDiff:S==null?void 0:S.toFixed(3),armTorso:l==null?void 0:l.toFixed(1),shWrX:i==null?void 0:i.toFixed(3),khsAngle:g==null?void 0:g.toFixed(1),thresholds:{straightStartDeg:this.straightStartDeg,shHipYStartMax:this.shHipYStartMax,armTorsoMaxDeg:this.armTorsoMaxDeg,shWrXStartMin:this.shWrXStartMin}}),m==null||S==null||l==null)return console.log(`[${this.name}] âŒ canStart -> false (missing: ang=${m}, yDiff=${S}, armTorso=${l})`),!1;if(l>this.armTorsoMaxDeg)return console.log(`[${this.name}] âŒ canStart -> false (armTorso ${l.toFixed(1)}Â° > ${this.armTorsoMaxDeg}Â°)`),!1;if(this.requireShouldersAheadOfWrists&&(i==null||i<this.shWrXStartMin))return console.log(`[${this.name}] âŒ canStart -> false (shWrX ${i==null?void 0:i.toFixed(3)} < ${this.shWrXStartMin})`),!1;if(this.name==="Adv. tuck planche"&&(g==null||g<82))return console.log(`[${this.name}] âŒ canStart -> false (khsAngle ${g==null?void 0:g.toFixed(1)}Â° < 82Â°)`),!1;const y=this.straightStartDeg==null?!0:m>=this.straightStartDeg-this.hysteresisDeg,f=S<=this.shHipYStartMax;return y||console.log(`[${this.name}] âŒ canStart -> false (angle ${m.toFixed(1)}Â° < ${this.straightStartDeg-this.hysteresisDeg}Â°)`),f||console.log(`[${this.name}] âŒ canStart -> false (yDiff ${S.toFixed(3)} > ${this.shHipYStartMax})`),y&&f&&console.log(`[${this.name}] âœ… canStart -> TRUE!`),y&&f},canComplete(e){const{aL:t,aR:s,shHipYL:n,shHipYR:a,shWrXL:h,shWrXR:o,hkaAngleL:d,hkaAngleR:u}=this._poseMetrics(e),r=t==null?s:s==null?t:(t+s)/2,p=n==null?a:a==null?n:(n+a)/2,m=h==null?o:o==null?h:(h+o)/2,S=d==null?u:u==null?d:(d+u)/2;return r==null||p==null?!0:(this.name==="Full planche"||this.name==="Straddle planche"||this.name==="Planche lean")&&S!=null&&S<this.hkaAngleMinStop?(console.log(`VideoAnalyzer canComplete -> true (jambes pliÃ©es: hkaAngle ${S}Â° < ${this.hkaAngleMinStop}Â°)`),!0):!!(this.requireShouldersAheadOfWrists&&(m==null||m<this.shWrXStopMin)||this.straightStopDeg!=null&&r<=this.straightStopDeg+this.hysteresisDeg||p>=this.shHipYStopMax)},getAscentSignal(e){const t=e[11],s=e[12];return!c(t,.35)||!c(s,.35)?null:(t.y+s.y)/2}}}function w(E,e={}){return{name:E,mode:"hold",tracking:"timer",initState:"off",activeState:"on",idleEndState:"off",requiredVisibility:.45,armTorsoMaxDeg:135,shHipYMax:.08,hipAnkleYMax:.12,hysteresisDeg:2,sidePolicy:"either",_poseMetrics(t){const s=t[11],n=t[12],a=t[13],h=t[14],o=t[23],d=t[24],u=t[25],r=t[26],p=t[27],m=t[28],S=c(s,this.requiredVisibility)&&c(a,this.requiredVisibility)&&c(o,this.requiredVisibility)&&c(p,this.requiredVisibility),l=c(n,this.requiredVisibility)&&c(h,this.requiredVisibility)&&c(d,this.requiredVisibility)&&c(m,this.requiredVisibility),i=S?v(a,s,o):null,g=l?v(h,n,d):null,y=S?Math.abs(s.y-o.y):null,f=l?Math.abs(n.y-d.y):null,A=S?Math.abs(o.y-p.y):null,M=l?Math.abs(d.y-m.y):null,k=S&&c(u,this.requiredVisibility)?v(o,u,p):null,L=l&&c(r,this.requiredVisibility)?v(d,r,m):null;return{armTorsoL:i,armTorsoR:g,shHipYL:y,shHipYR:f,hipAnkYL:A,hipAnkYR:M,hkaAngleL:k,hkaAngleR:L}},_avg(t,s){return t==null?s:s==null?t:(t+s)/2},canStart(t){const{armTorsoL:s,armTorsoR:n,shHipYL:a,shHipYR:h,hipAnkYL:o,hipAnkYR:d}=this._poseMetrics(t),u=this._avg(s,n),r=this._avg(a,h),p=this._avg(o,d);return!(u==null||r==null||p==null||u>this.armTorsoMaxDeg+this.hysteresisDeg||r>this.shHipYMax||p>this.hipAnkleYMax)},canComplete(t){const{armTorsoL:s,armTorsoR:n,shHipYL:a,shHipYR:h,hipAnkYL:o,hipAnkYR:d}=this._poseMetrics(t),u=this._avg(s,n),r=this._avg(a,h),p=this._avg(o,d);return u==null||r==null||p==null||u>this.armTorsoMaxDeg+this.hysteresisDeg||r>this.shHipYMax||p>this.hipAnkleYMax},getAscentSignal(t){const s=t[11],n=t[12];return!c(s,.35)||!c(n,.35)?null:(s.y+n.y)/2},...e}}function j(E,e={}){return{name:E,mode:"hold",tracking:"timer",initState:"off",activeState:"on",idleEndState:"off",requiredVisibility:.45,straightStartDeg:155,straightStopDeg:135,hysteresisDeg:3,shHipYMax:.08,hipAnkleYMax:.1,armTorsoMaxDeg:140,sidePolicy:"either",_poseMetrics(t){const s=t[11],n=t[12],a=t[13],h=t[14],o=t[23],d=t[24],u=t[27],r=t[28],p=c(s,this.requiredVisibility)&&c(a,this.requiredVisibility)&&c(o,this.requiredVisibility)&&c(u,this.requiredVisibility),m=c(n,this.requiredVisibility)&&c(h,this.requiredVisibility)&&c(d,this.requiredVisibility)&&c(r,this.requiredVisibility),S=p?v(s,o,u):null,l=m?v(n,d,u):null,i=p?v(a,s,o):null,g=m?v(h,n,d):null,y=p?Math.abs(s.y-o.y):null,f=m?Math.abs(n.y-d.y):null,A=p?Math.abs(o.y-u.y):null,M=m?Math.abs(d.y-r.y):null;return{straightL:S,straightR:l,armTorsoL:i,armTorsoR:g,shHipYL:y,shHipYR:f,hipAnkYL:A,hipAnkYR:M}},_avg(t,s){return t==null?s:s==null?t:(t+s)/2},canStart(t){const s=this._poseMetrics(t),n=this._avg(s.straightL,s.straightR),a=this._avg(s.armTorsoL,s.armTorsoR),h=this._avg(s.shHipYL,s.shHipYR),o=this._avg(s.hipAnkYL,s.hipAnkYR);return n==null||a==null||h==null||o==null||a>this.armTorsoMaxDeg?!1:n>=this.straightStartDeg-this.hysteresisDeg&&h<=this.shHipYMax&&o<=this.hipAnkleYMax},canComplete(t){const s=this._poseMetrics(t),n=this._avg(s.straightL,s.straightR),a=this._avg(s.shHipYL,s.shHipYR),h=this._avg(s.hipAnkYL,s.hipAnkYR);return n==null||a==null||h==null||n<=this.straightStopDeg+this.hysteresisDeg||a>this.shHipYMax||h>this.hipAnkleYMax},getAscentSignal(t){const s=t[11],n=t[12];return!c(s,.35)||!c(n,.35)?null:(s.y+n.y)/2},...e}}function G(){return{Tractions:K,Pompes:z,Handstand:U,"Handstand Push Up":O,"90 Degree HSPU":X,Dips:V,"Front Lever Raises":W,"Straddle planche":R({...H("Straddle planche"),name:"Straddle planche"}),"Full planche":R({...H("Full planche"),name:"Full planche",straightStartDeg:129,straightStopDeg:125,shHipYStartMax:.28,shHipYStopMax:.3,shWrXStartMin:.2,shWrXStopMin:.19,armTorsoMaxDeg:120}),"Tuck planche":R({...H("Tuck planche"),name:"Tuck planche",straightStartDeg:null,straightStopDeg:null,shHipYStartMax:.11,shHipYStopMax:.09,shWrXStartMin:.06,shWrXStopMin:.05}),"Adv. tuck planche":R({...H("Adv. tuck planche"),name:"Adv. tuck planche",straightStartDeg:null,straightStopDeg:null,shHipYStartMax:.11,shHipYStopMax:.09,shWrXStartMin:.06,shWrXStopMin:.05}),"Planche lean":R({...H("Planche lean"),name:"Planche lean",shHipYStartMax:.09,shHipYStopMax:.1}),"Front Lever":w("Front Lever",{armTorsoMaxDeg:100}),"Tuck Front Lever":w("Tuck Front Lever",{armTorsoMaxDeg:145}),"Straddle Front Lever":w("Straddle Front Lever",{armTorsoMaxDeg:140}),"Human Flag":j("Human Flag")}}class J{constructor(){this.videoElement=document.getElementById("videoElement"),this.canvasElement=document.getElementById("canvasElement"),this.ctx=this.canvasElement.getContext("2d"),this.poseLandmarker=null,this.exercise=null,this.EXERCISES=G(),this.isAnalyzing=!1,this.repState=null,this.repStarted=!1,this.stateFrameCount=0,this.consecutiveFramesRequired=2,this.currentSetReps=0,this.holdStartTime=null,this.currentSetDisplay=null,this.qualitySamples=[],this.leanScoreSamples=[],this.trunkScoreSamples=[],this.alignmentScoreSamples=[],this.kneeHipShoulderScoreSamples=[],this.straightLegsScoreSamples=[],this.verticalityScoreSamples=[],this.elbowDepthScoreSamples=[],this.alignmentAngleSamples=[],this.verticalityAngleSamples=[],this.setupUI(),this.initializePoseTracking()}setupUI(){const e=document.getElementById("videoFile"),t=document.getElementById("analyzeBtn"),s=document.getElementById("restartBtn"),n=document.getElementById("reanalyzeBtn");e.addEventListener("change",a=>{if(a.target.files.length>0){t.disabled=!1;const h=a.target.files[0],o=URL.createObjectURL(h);this.videoElement.src=o,this.videoElement.load()}}),t.addEventListener("click",()=>this.startAnalysis()),n.addEventListener("click",()=>this.reanalyze()),s.addEventListener("click",()=>this.restart())}async initializePoseTracking(){try{const e=await N.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14/wasm");this.poseLandmarker=await Q.createFromOptions(e,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/1/pose_landmarker_lite.task",delegate:"GPU"},runningMode:"VIDEO",numPoses:1}),console.log("âœ… PoseLandmarker initialized")}catch(e){console.error("âŒ Failed to initialize PoseLandmarker:",e),this.showStatus("Erreur d'initialisation de la dÃ©tection de pose","error")}}async startAnalysis(){const e=document.getElementById("exerciseSelect").value;if(this.exercise=this.EXERCISES[e],!this.exercise){this.showStatus("Exercice non reconnu","error");return}if(!this.poseLandmarker){this.showStatus("DÃ©tection de pose non initialisÃ©e","error");return}this.repState=this.exercise.initState,this.repStarted=!1,this.stateFrameCount=0,this.currentSetReps=0,this.holdStartTime=null,this.currentSetDisplay=null,this.holdCompleted=!1,this.qualitySamples=[],this.leanScoreSamples=[],this.trunkScoreSamples=[],this.alignmentScoreSamples=[],this.kneeHipShoulderScoreSamples=[],this.straightLegsScoreSamples=[],this.verticalityScoreSamples=[],this.elbowDepthScoreSamples=[],this.alignmentAngleSamples=[],this.verticalityAngleSamples=[],this.shHipYSamples=[],this.shWrXSamples=[],this.hkaAngleSamples=[],this.khsAngleSamples=[],this.elbowAngleSamples=[],this.currentRepElbowAngles=[],document.getElementById("uploadSection").style.display="none",document.getElementById("videoPreview").classList.add("active"),document.getElementById("progressBar").classList.add("active"),document.getElementById("results").classList.remove("active"),this.showStatus("Analyse en cours...","processing"),this.isAnalyzing=!0,this.videoElement.addEventListener("loadedmetadata",()=>{this.canvasElement.width=this.videoElement.videoWidth,this.canvasElement.height=this.videoElement.videoHeight},{once:!0}),await this.videoElement.play(),this.processVideo()}async processVideo(){const e=async()=>{if(!this.isAnalyzing||this.videoElement.paused||this.videoElement.ended){this.videoElement.ended&&this.finalizeAnalysis();return}const t=this.videoElement.currentTime/this.videoElement.duration*100;document.getElementById("progressFill").style.width=`${t}%`,document.getElementById("progressFill").textContent=`${Math.round(t)}%`;const s=this.poseLandmarker.detectForVideo(this.videoElement,performance.now());if(this.ctx.clearRect(0,0,this.canvasElement.width,this.canvasElement.height),s.landmarks&&s.landmarks.length>0){const n=s.landmarks[0];this.drawLandmarks(n),this.trackMovement(n),this.sampleQuality(n)}requestAnimationFrame(e)};e()}trackMovement(e){if(!(!e||!this.exercise)){if(this.exercise.tracking==="timer"||this.exercise.mode==="hold"){this.trackTimer(e);return}if(this.repState===this.exercise.initState)!this.repStarted&&this.exercise.canStart(e)?(this.stateFrameCount++,this.stateFrameCount>=this.consecutiveFramesRequired&&(this.repState=this.exercise.activeState,this.repStarted=!0,this.stateFrameCount=0)):this.stateFrameCount=0;else if(this.repState===this.exercise.activeState)if(this.repStarted&&this.exercise.canComplete(e)){if(this.stateFrameCount++,this.stateFrameCount>=this.consecutiveFramesRequired){if(this.repState=this.exercise.initState,this.currentSetReps++,(this.exercise.name==="Handstand Push Up"||this.exercise.name==="90 Degree HSPU")&&this.currentRepElbowAngles.length>0){const t=Math.min(...this.currentRepElbowAngles);this.elbowAngleSamples.push(t);const s=q(t);this.elbowDepthScoreSamples.push(s),console.log(`[VA Rep ${this.currentSetReps}] Min: ${t.toFixed(1)}Â° â†’ Score: ${s}/10`),this.currentRepElbowAngles=[]}this.stateFrameCount=0,this.repStarted=!1}}else this.stateFrameCount=0}}trackTimer(e){if(!this.holdCompleted){if(this.repState===this.exercise.initState)!this.repStarted&&this.exercise.canStart(e)?(this.stateFrameCount++,this.stateFrameCount>=this.consecutiveFramesRequired&&(this.repState=this.exercise.activeState,this.repStarted=!0,this.stateFrameCount=0,this.holdStartTime=this.videoElement.currentTime,this.currentSetReps=0,console.log(`ðŸŸ¢ Hold START at ${this.holdStartTime.toFixed(2)}s`))):this.stateFrameCount=0;else if(this.repState===this.exercise.activeState){if(this.holdStartTime!=null){const t=Math.max(0,this.videoElement.currentTime-this.holdStartTime),s=Math.floor(t);s!==this.currentSetReps&&(this.currentSetReps=s),this.currentSetDisplay=Math.round(t*10)/10}if(this.repStarted&&this.exercise.canComplete(e)){if(this.stateFrameCount++,this.stateFrameCount>=this.consecutiveFramesRequired){const t=this.videoElement.currentTime;if(this.repState=this.exercise.initState,this.stateFrameCount=0,this.repStarted=!1,this.holdStartTime!=null){const s=Math.max(0,t-this.holdStartTime);this.currentSetReps=Math.max(this.currentSetReps,Math.floor(s)),console.log(`ðŸ”´ Hold STOP at ${t.toFixed(2)}s (duration: ${s.toFixed(2)}s)`),this.holdCompleted=!0}}}else this.stateFrameCount=0}}}sampleQuality(e){var n,a,h,o,d,u,r,p,m,S;if(!this.exercise||this.repState!==this.exercise.activeState)return;let t=null;const s=this.exercise.name||"";if(s.toLowerCase().includes("planche")){const l=C(e,this.exercise);t=l==null?void 0:l.avgScore,(l==null?void 0:l.leanScore)!=null&&this.leanScoreSamples.push(l.leanScore),(l==null?void 0:l.trunkScore)!=null&&this.trunkScoreSamples.push(l.trunkScore),(l==null?void 0:l.alignmentScore)!=null&&this.alignmentScoreSamples.push(l.alignmentScore),(l==null?void 0:l.kneeHipShoulderScore)!=null&&this.kneeHipShoulderScoreSamples.push(l.kneeHipShoulderScore),(l==null?void 0:l.straightLegsScore)!=null&&this.straightLegsScoreSamples.push(l.straightLegsScore);const i=(a=(n=this.exercise)._poseMetrics)==null?void 0:a.call(n,e);if(i){const g=i.aL==null?i.aR:i.aR==null?i.aL:(i.aL+i.aR)/2,y=i.shHipYL==null?i.shHipYR:i.shHipYR==null?i.shHipYL:(i.shHipYL+i.shHipYR)/2,f=i.shWrXL==null?i.shWrXR:i.shWrXR==null?i.shWrXL:(i.shWrXL+i.shWrXR)/2,A=i.hkaAngleL==null?i.hkaAngleR:i.hkaAngleR==null?i.hkaAngleL:(i.hkaAngleL+i.hkaAngleR)/2,M=i.khsAngleL==null?i.khsAngleR:i.khsAngleR==null?i.khsAngleL:(i.khsAngleL+i.khsAngleR)/2;g!=null&&this.alignmentAngleSamples.push(g),y!=null&&this.shHipYSamples.push(y),f!=null&&this.shWrXSamples.push(f),A!=null&&this.hkaAngleSamples.push(A),M!=null&&this.khsAngleSamples.push(M)}}else if(this.exercise.mode==="hold"&&typeof this.exercise._effectiveAngle=="function"){const l=this.exercise._effectiveAngle(e);if(t=$(l,175,b),t!=null&&this.alignmentScoreSamples.push(t),l!=null&&this.alignmentAngleSamples.push(l),s==="Handstand"){const i=e[11],g=e[12],y=e[27],f=e[28],A=c(i,.4)&&c(y,.4),M=c(g,.4)&&c(f,.4),k=A&&M?{x:(i.x+g.x)/2,y:(i.y+g.y)/2}:A?i:M?g:null,L=A&&M?{x:(y.x+f.x)/2,y:(y.y+f.y)/2}:A?y:M?f:null;if(k&&L){const T=_(k,L,b);if(T!=null){this.verticalityScoreSamples.push(T);const D=L.x-k.x,Y=L.y-k.y,F=Math.atan2(Math.abs(D),Math.abs(Y))*180/Math.PI;this.verticalityAngleSamples.push(F)}}}}else if(s==="Handstand Push Up"){const l=(o=(h=this.exercise)._elbowAngles)==null?void 0:o.call(h,e);console.log(`[VA HSPU] repState: ${this.repState}, activeState: ${this.exercise.activeState}, angle: ${l==null?void 0:l.toFixed(1)}Â°`);const i=(u=(d=this.exercise)._bodyAlignment)==null?void 0:u.call(d,e),g=$(i,180,b);this.repState===this.exercise.activeState&&l!=null&&this.currentRepElbowAngles.push(l),g!=null&&(this.alignmentScoreSamples.push(g),i!=null&&this.alignmentAngleSamples.push(i)),t=null}else if(s==="90 Degree HSPU"){const l=(p=(r=this.exercise)._poseMetrics)==null?void 0:p.call(r,e),i=l?l.elbowL??l.elbowR:null,g=(S=(m=this.exercise)._bodyAlignment)==null?void 0:S.call(m,e),y=$(g,180,b);this.repState===this.exercise.activeState&&i!=null&&this.currentRepElbowAngles.push(i),y!=null&&(this.alignmentScoreSamples.push(y),g!=null&&this.alignmentAngleSamples.push(g)),t=null}t!=null&&this.qualitySamples.push(t)}drawLandmarks(e){const t=[[11,12],[11,23],[12,24],[23,24],[11,13],[13,15],[12,14],[14,16],[23,25],[25,27],[24,26],[26,28]];this.ctx.strokeStyle="#00ff00",this.ctx.lineWidth=3,t.forEach(([n,a])=>{const h=e[n],o=e[a];h&&o&&c(h,.3)&&c(o,.3)&&(this.ctx.beginPath(),this.ctx.moveTo(h.x*this.canvasElement.width,h.y*this.canvasElement.height),this.ctx.lineTo(o.x*this.canvasElement.width,o.y*this.canvasElement.height),this.ctx.stroke())}),this.ctx.fillStyle="#ff0000",[0,11,12,13,14,15,16,23,24,25,26,27,28].forEach(n=>{const a=e[n];a&&c(a,.3)&&(this.ctx.beginPath(),this.ctx.arc(a.x*this.canvasElement.width,a.y*this.canvasElement.height,5,0,2*Math.PI),this.ctx.fill())})}finalizeAnalysis(){this.isAnalyzing=!1,this.videoElement.pause();const e={leanScore:this.leanScoreSamples.length>0?Math.round(x(this.leanScoreSamples)*10)/10:null,trunkScore:this.trunkScoreSamples.length>0?Math.round(x(this.trunkScoreSamples)*10)/10:null,alignmentScore:this.alignmentScoreSamples.length>0?Math.round(x(this.alignmentScoreSamples)*10)/10:null,kneeHipShoulderScore:this.kneeHipShoulderScoreSamples.length>0?Math.round(x(this.kneeHipShoulderScoreSamples)*10)/10:null,straightLegsScore:this.straightLegsScoreSamples.length>0?Math.round(x(this.straightLegsScoreSamples)*10)/10:null,verticalityScore:this.verticalityScoreSamples.length>0?Math.round(x(this.verticalityScoreSamples)*10)/10:null,elbowDepthScore:this.elbowDepthScoreSamples.length>0?Math.round(x(this.elbowDepthScoreSamples)*10)/10:null,alignmentAngle:this.alignmentAngleSamples.length>0?Math.round(x(this.alignmentAngleSamples)*10)/10:null,verticalityAngle:this.verticalityAngleSamples.length>0?Math.round(x(this.verticalityAngleSamples)*10)/10:null,shHipY:this.shHipYSamples.length>0?Math.round(x(this.shHipYSamples)*1e3)/1e3:null,shWrX:this.shWrXSamples.length>0?Math.round(x(this.shWrXSamples)*1e3)/1e3:null,hkaAngle:this.hkaAngleSamples.length>0?Math.round(x(this.hkaAngleSamples)*10)/10:null,khsAngle:this.khsAngleSamples.length>0?Math.round(x(this.khsAngleSamples)*10)/10:null,elbowAngle:this.elbowAngleSamples.length>0?Math.round(x(this.elbowAngleSamples)*10)/10:null};let t=null;if((this.exercise.name==="Handstand Push Up"||this.exercise.name==="90 Degree HSPU")&&e.elbowDepthScore!=null&&e.alignmentScore!=null)t=Math.round((e.elbowDepthScore+e.alignmentScore)/2*10)/10,console.log(`[VA] Score global calculÃ©: (${e.elbowDepthScore} + ${e.alignmentScore}) / 2 = ${t}`);else if(this.qualitySamples.length>0){const s=this.qualitySamples.length>3?this.qualitySamples.slice(0,-3):this.qualitySamples,n=x(s);t=n!=null?Math.round(n*10)/10:null}this.displayResults(t,e)}displayResults(e,t){document.getElementById("progressBar").classList.remove("active"),document.getElementById("status").classList.remove("active"),document.getElementById("results").classList.add("active"),document.getElementById("resultExerciseName").textContent=this.exercise.name;const s=this.exercise.tracking==="timer"||this.exercise.mode==="hold";if(document.getElementById("resultLabel").textContent=s?"DurÃ©e du hold":"RÃ©pÃ©titions",document.getElementById("resultValue").textContent=s?`${this.currentSetDisplay||this.currentSetReps}s`:this.currentSetReps,e!=null){const n=document.getElementById("qualityScoreSection");n.style.display="block";const a=document.getElementById("qualityScoreValue");a.textContent=`${e}/10`,a.classList.remove("excellent","good","poor"),e>=9?a.classList.add("excellent"):e>=7?a.classList.add("good"):a.classList.add("poor"),this.displayQualityDetails(t)}else document.getElementById("qualityScoreSection").style.display="none"}displayQualityDetails(e){const t=document.getElementById("qualityDetails");t.innerHTML="";const s=this.exercise.name,n=s==="Handstand",a=s==="Handstand Push Up",h=s==="90 Degree HSPU",o=s==="Adv. tuck planche",d=s==="Straddle planche"||s==="Full planche"||s==="Planche lean"||s==="Front Lever",u=[];if(e.alignmentScore!=null&&!a&&!h){const r=e.alignmentAngle!=null?` (Moy: ${e.alignmentAngle.toFixed(1)}Â°)`:"";u.push({icon:"ðŸ“",name:n?"Alignement corps":"Alignement",score:e.alignmentScore,description:`${n?"Ã‰paules-hanches-chevilles droites":"Alignement Ã©paules-hanches-chevilles"}${r}`})}if(e.verticalityScore!=null&&n){const r=e.verticalityAngle!=null?` (Moy: ${e.verticalityAngle.toFixed(1)}Â°)`:"";u.push({icon:"ðŸ“",name:"VerticalitÃ©",score:e.verticalityScore,description:`Alignement par rapport Ã  la verticale${r}`})}if(e.leanScore!=null&&!n){const r=e.shWrX!=null?` (shWrX: ${e.shWrX.toFixed(3)})`:"";u.push({icon:"ðŸ’Ž",name:"Lean (avancÃ©e)",score:e.leanScore,description:`Position des Ã©paules par rapport aux poignets${r}`})}if(e.trunkScore!=null){const r=e.shHipY!=null?` (shHipY: ${e.shHipY.toFixed(3)})`:"";u.push({icon:"ðŸŽ¯",name:"Tronc",score:e.trunkScore,description:`Alignement du tronc${r}`})}if(e.kneeHipShoulderScore!=null&&o){const r=e.khsAngle!=null?` (Moy: ${e.khsAngle.toFixed(1)}Â°)`:"";u.push({icon:"ðŸ¦µ",name:"Genou-Hanche-Ã‰paule",score:e.kneeHipShoulderScore,description:`Alignement spÃ©cifique Advanced Tuck${r}`})}if(e.straightLegsScore!=null&&d){const r=e.hkaAngle!=null?` (Moy: ${e.hkaAngle.toFixed(1)}Â°)`:"";u.push({icon:"ðŸ¦µ",name:"Jambes tendues",score:e.straightLegsScore,description:`Extension des jambes${r}`})}if(e.elbowDepthScore!=null&&(a||h)){const r=e.elbowAngle!=null?` (Moy: ${e.elbowAngle.toFixed(1)}Â°)`:"";u.push({icon:"ðŸ’ª",name:"Profondeur coude",score:e.elbowDepthScore,description:`Angle du coude Ã  la descente${r}`})}if(e.alignmentScore!=null&&(a||h)){const r=e.alignmentAngle!=null?` (Moy: ${e.alignmentAngle.toFixed(1)}Â°)`:"";u.push({icon:"ðŸ“",name:"Alignement du corps",score:e.alignmentScore,description:`Ã‰paules-hanches-chevilles droites${r}`})}u.forEach(r=>{const p=document.createElement("div");p.className="quality-detail-item",p.innerHTML=`
        <div class="quality-detail-icon">${r.icon}</div>
        <div class="quality-detail-name">${r.name}</div>
        <div class="quality-detail-score">${r.score}/10</div>
        <div class="quality-detail-description">${r.description}</div>
      `,t.appendChild(p)})}showStatus(e,t){const s=document.getElementById("status");s.textContent=e,s.className=`status active ${t}`}reanalyze(){document.getElementById("results").classList.remove("active"),document.getElementById("progressBar").classList.remove("active"),document.getElementById("status").classList.remove("active"),this.isAnalyzing=!1,this.currentSetReps=0,this.currentSetDisplay=0,this.repState=null,this.repStarted=!1,this.stateFrameCount=0,this.holdStartTime=null,this.qualitySamples=[],this.leanScoreSamples=[],this.trunkScoreSamples=[],this.alignmentScoreSamples=[],this.kneeHipShoulderScoreSamples=[],this.straightLegsScoreSamples=[],this.verticalityScoreSamples=[],this.elbowDepthScoreSamples=[],this.alignmentAngleSamples=[],this.verticalityAngleSamples=[],this.videoElement.currentTime=0,this.videoElement.pause(),this.ctx.clearRect(0,0,this.canvasElement.width,this.canvasElement.height),this.startAnalysis()}restart(){document.getElementById("uploadSection").style.display="block",document.getElementById("videoPreview").classList.remove("active"),document.getElementById("results").classList.remove("active"),document.getElementById("progressBar").classList.remove("active"),document.getElementById("status").classList.remove("active"),document.getElementById("videoFile").value="",document.getElementById("analyzeBtn").disabled=!0,this.videoElement.src="",this.videoElement.load(),this.isAnalyzing=!1}}document.addEventListener("DOMContentLoaded",()=>{new J});
